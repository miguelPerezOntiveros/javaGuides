<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<!-- jQuery -->
	<script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>

	<!-- marked -->
	<script src="node_modules/marked/marked.min.js"></script>

	<!-- code-prettyfy -->
	<link href="google-code-prettify/prettify.css" type="text/css" rel="stylesheet" />
	<script type="text/javascript" src="google-code-prettify/prettify.js"></script>

	<!-- Bootstrap -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
	
	<link href='https://fonts.googleapis.com/css?family=Amiri' rel='stylesheet' type='text/css'>
	<link href="style.css" rel="stylesheet">

	<title>Document</title>

	<style>
		#hoverable {
			z-index:1;
		    position:absolute;
		    margin: 0;
		    left: 50%;
		    transform: translate(-50%, 0%)
		}

		.fixed {
		    position: fixed;
		}

		/* sidebar */
		.bs-docs-sidebar {
			overflow: hidden;
		    padding-left: 20px;
		    margin-top: 50px;
		    margin-bottom: 20px;
		}

		/* all links */
		.bs-docs-sidebar .nav>li>a {
		    color: #999;
		    border-left: 2px solid transparent;
		    padding: 4px 20px;
		    font-size: 13px;
		    font-weight: 400;
		}

		/* nested links */
		.bs-docs-sidebar .nav .nav>li>a {
		    padding-top: 1px;
		    padding-bottom: 1px;
		    padding-left: 30px;
		    font-size: 12px;
		}

		/* active & hover links */
		.bs-docs-sidebar .nav>.active>a, 
		.bs-docs-sidebar .nav>li>a:hover, 
		.bs-docs-sidebar .nav>li>a:focus {
		    color: #227;                 
		    text-decoration: none;          
		    background-color: transparent;  
		    border-left-color: #227; 
		}
		/* all active links */
		.bs-docs-sidebar .nav>.active>a, 
		.bs-docs-sidebar .nav>.active:hover>a,
		.bs-docs-sidebar .nav>.active:focus>a {
		    font-weight: 700;
		}
		/* nested active links */
		.bs-docs-sidebar .nav .nav>.active>a, 
		.bs-docs-sidebar .nav .nav>.active:hover>a,
		.bs-docs-sidebar .nav .nav>.active:focus>a {
		    font-weight: 500;
		}

		/* hide inactive nested list */
		.bs-docs-sidebar .nav ul.nav {
		    display: none;           
		}
		/* show active nested list */
		.bs-docs-sidebar .nav>.active>ul.nav {
		    display: block;           
		}
	</style>
</head>
<body>
	 <div id="hoverable">
		<nav class="navbar navbar-default" id="movable">
			<div class="container-fluid">
				<div class="collapse navbar-collapse">
					<ul id="top" class="nav navbar-nav">
						<li><a id="menu1">1</a></li>
						<li><a id="menu2">2</a></li>
						<li><a id="menu3">3</a></li>
						<li><a id="menu4">4</a></li>
						<li><a id="menu5">5</a></li>
						<li><a id="menu6">6</a></li>
					</ul>
				</div><!-- /.navbar-collapse -->
			</div><!-- /.container-fluid -->
		</nav>
	</div>

	<div class="container" style="text-align: justify;">
		<div class="row" id="guides">
			<div class="col-md-3">
				<nav class="bs-docs-sidebar">
					<ul id="sidebar" class="nav nav-stacked fixed"></ul>
			    </nav>
			</div>
			<div class="col-md-9">
				<div id="middle"></div>
			</div>
		</div>
	</div>
	<script>
		window.inTriggerZone = false;
		window.triggerZoneThresh = 100;
		document.onmousemove = (event) => {
			if(event.pageY < triggerZoneThresh && !inTriggerZone)
			{
				$("#hoverable").animate({marginTop: '0px'});
				inTriggerZone = true;
			}
			if(event.pageY >= triggerZoneThresh && inTriggerZone)
			{
				$("#hoverable").animate({marginTop: '-' + $("#hoverable").height() +'px'});

				inTriggerZone = false;
			}
	    };

		$("#hoverable").css({marginTop: '-' + $("#hoverable").height() +'px'});
    	
		document.onkeydown = (e) => {
			switch(e.keyCode)
			{
				case 38: // up
					break;
				case 40: // down
		    		break;
		    	case 37:
		    		fillContent(--currentPage); // left
		    		break;
		    	case 39:
		    		fillContent(++currentPage); // right
		    		break;
		    }

		}

		$('#leftArrow').click( () =>{ fillContent(--currentPage); });
		$('#rightArrow').click( () =>{ fillContent(++currentPage); });

		for(let i = 0; i < 20; i++)
			$('#menu' + i).click( () => fillContent(currentPage = i) );

		var currentPage = 1;
		fillContent(currentPage);

		var upperLimit = 6;
		var lowerLimit = 1;

		function fillContent(chapter){
			if(currentPage < lowerLimit)
				currentPage = lowerLimit;
			if(currentPage > upperLimit)
				currentPage = upperLimit;

			 $('#top').children().each( (i, e) => { $(e).removeClass('active'); } );
			 $('#menu'+currentPage).parent().addClass('active'); 

			$('#leftArrow').show();
			$('#rightArrow').show();
			if(currentPage == lowerLimit)
				$('#leftArrow').hide();
			if(currentPage == upperLimit)
				$('#rightArrow').hide();
			
			new Promise(function(resolve){
				$.get( 'md/OCA chapter' + chapter + '.md.txt', function( data ) {
					$('#middle').html(marked(data));
					resolve('middle');
				});
			}).then( afterLoading );
		}

		function afterLoading(id){
				$('#sidebar').html('');
				var h3cnt = 0;
				$('#'+id).find('h1, h3, h6').each( (num, entry)=>{ 
					if( $(entry).is('h3') ||  $(entry).is('h1') )
						$('#sidebar').append('<li><a href="#' + id + num +'">' + $(entry).html() +'</a><ul class="nav nav-stacked" id="' + id + (++h3cnt) + '_sub_ul"></ul></li>'); 
					else
						$('#' + id + h3cnt + '_sub_ul').append('<li><a href="#' + id + num +'">' + $(entry).html() +'</a></li>');
				
					$(entry).prepend('<section id = ' + id + num +'></section>' );
				});

				$('body').animate({ scrollTop: (0) }, 'fast');

				$( "code" ).each(function() {
				  $( this ).addClass( "prettyprint" );
				}); 
	    		prettyPrint();

				$('body').scrollspy({
				    target: '.bs-docs-sidebar',
				    offset: 40
				});
		}

	</script>

</body>
</html>
